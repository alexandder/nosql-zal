= Technologie nosql - zaliczenie
Aleksander Bolt <aleksanderbolt@yahoo.com>
:icons: font

W projekcie użyłem następujący sprzęt i technologie:

[format="csv"]
|===
Procesor, Intel(R) Core(TM) i5-2430M CPU @ 2.40GHz
Pamięc RAM, 8GB
Dysk, SSD
System operacyjny, Linux 3.13.0-24-generic Mint 17 Qiana
MongoDB, 3.0.7
PostgreSQL, 9.3.5
Python, 2.7.7
|===

Poddałem analizie zbiór https://dl.dropboxusercontent.com/u/15056258/mongodb/reddit.zip[subreditów]. Spakowany w formacie zip ma on 209,6 MB, zaś rozpakowany 1,2 GB.

== Przetwarzane wstępne

W celu zaimportowania danych do bazy PostgreSQL wygodniej jest operować plikiem w formacie json. Przekształcamy pobrany plik subreddit.bson poleceniem:

[source]
bsondump subreddit.bson > subreddit.json

Ponieważ w opisie subredditów znajdują się często słowa z pojedynczym apostrofem (na przykład don't), zastępujemy znak ' znakiem spacji. W przeciwnym wypadku otrzymalibyśmy błąd przy próbie wstawienia danych. Można to zrobić np. tak

[source]
sed "s/'/ /g" subreddit.json > subreddits.json

== Import danych

Importujemy do MongoDB pobrany plik subreddit.bson, poleceniem:

[source]
time mongorestore -d nosql -c subreddit subreddit.bson

![](https://github.com/alexandder/nosql-zal/blob/master/images/mongoStart.jpg)

image::https://github.com/alexandder/nosql-zal/blob/master/images/mongoEnd.jpg

Czas importu wynosi 3 minuty i 13 sekund.

W celu zaimportowania danych do bazy PostgreSQL, tworzymy najpierw tabelę:

[source]
CREATE TABLE subreddits(
	id serial primary key,
	data json
);

Do importu wykorzystamy biblotekę psycopg2 oraz https://github.com/alexandder/nosql-zal/blob/master/insert.py[skrypt]. 
W jego wyniku otrzymamy

image::https://github.com/alexandder/nosql-zal/blob/master/images/postgresInsert.jpg

Czas importu wynosi 6 minut i 17 sekund

== Zliczanie rekordów

W obu bazach zliczamy rekordy:

image::https://github.com/alexandder/nosql-zal/blob/master/images/mongoCount.jpg

image::https://github.com/alexandder/nosql-zal/blob/master/images/postgresCount.jpg


Zatem w obu przypadkach zaimportowaliśmy 904490 rekordów.
